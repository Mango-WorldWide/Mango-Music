import { usePlayer } from "../../context/PlayerContext";
import { singleSongThunk } from "../../store/song";
import { useDispatch } from 'react-redux'
import { useRef } from "react";

const PlayButton = ({ songId, songs, isButton = false }) => {
  // const audioPlayer = useRef();
  // console.log("audioPlayer ðŸ‘‰ ðŸ‘‰ ðŸ‘‰ ðŸ‘‰ ðŸ‘‰", audioPlayer)
  // console.log("isButton from PlayButton ðŸ‘‰ðŸ‘‰ðŸ‘‰ðŸ‘‰ðŸ‘‰", isButton);
  // console.log("songId from PlayButton ðŸ‘‰ðŸ‘‰ðŸ‘‰ðŸ‘‰ðŸ‘‰", songId);
  // console.log("songs from PlayButton  ðŸ‘‰ðŸ‘‰ðŸ‘‰ðŸ‘‰", songs);
  const dispatch = useDispatch();
  const {
    isPlaying,
    setIsPlaying,
    currentSong,
    setCurrentSong,
    currentSongIndex,
    setCurrentSongIndex,
    songsArr,
    setSongsArr,
  } = usePlayer();
  // console.log(songs, "PLAY SONGSSSSSSS");
  const songArrId = songs.map((x) => x["id"]);
  // console.log(songArrId, "play button song arr id");
  const songIndex = songArrId.indexOf(songId);
  // console.log(songId, " song id inside play button");
  const handleClick = async () => {
    // console.log("songId from play button ðŸ‘ºðŸ‘ºðŸ‘ºðŸ‘ºðŸ‘º", songId)
    // console.log("currentSongIndex from play buttonðŸ‘ºðŸ‘ºðŸ‘ºðŸ‘ºðŸ‘º", currentSongIndex)
    // console.log("isPlaying from play button ðŸ‘‰", isPlaying);
    console.log("currentSong from play button ðŸ‘‰", currentSong);
    // console.log("songIndexx from play button ðŸ‘‰ðŸ‘‰ðŸ‘‰", songIndex);
    if (isPlaying && currentSongIndex === songIndex) {
      setIsPlaying(false);
    } else {
      const theSong = await dispatch(singleSongThunk(songId));
      console.log("theSong MP3 from play button ðŸ‘‰ðŸ‘‰ðŸ‘‰", theSong);
      setCurrentSongIndex(songIndex);
      setSongsArr(songs);
      setIsPlaying(true);
      setCurrentSong(theSong.mp3);
      // setCurrentSong(songIndex);
    }
  };

  return (
    <>
      {isButton ? (
        <button onClick={handleClick} className="playlistButton">
          {isPlaying ? (
            <>
              <i className="fa fa-pause" aria-hidden="true" />
              Pause
            </>
          ) : (
            <>
              <i class="fa fa-play" aria-hidden="true" />
              Play
            </>
          )}
        </button>
      ) : (
        <p onClick={handleClick} className="play-pause-btn">
          {isPlaying && songId === songsArr[currentSongIndex].id ? (
            <i className="fa fa-pause" aria-hidden="true"></i>
          ) : (
            <i class="fa fa-play" aria-hidden="true"></i>
          )}
        </p>
      )}
    </>
  );
};

export default PlayButton;
